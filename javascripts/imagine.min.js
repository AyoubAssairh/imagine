!function(t,i){"function"==typeof define&&define.amd?define(i):"object"==typeof exports?module.exports=i():t.imagine=i()}(this,function(){var t,i,e;return function(n){function o(t,i){return m.call(t,i)}function s(t,i){var e,n,o,s,r,a,p,c,h,u,f,l=i&&i.split("/"),d=w.map,v=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(i){for(l=l.slice(0,l.length-1),t=t.split("/"),r=t.length-1,w.nodeIdCompat&&j.test(t[r])&&(t[r]=t[r].replace(j,"")),t=l.concat(t),h=0;h<t.length;h+=1)if(f=t[h],"."===f)t.splice(h,1),h-=1;else if(".."===f){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((l||v)&&d){for(e=t.split("/"),h=e.length;h>0;h-=1){if(n=e.slice(0,h).join("/"),l)for(u=l.length;u>0;u-=1)if(o=d[l.slice(0,u).join("/")],o&&(o=o[n])){s=o,a=h;break}if(s)break;!p&&v&&v[n]&&(p=v[n],c=h)}!s&&p&&(s=p,a=c),s&&(e.splice(0,a,s),t=e.join("/"))}return t}function r(t,i){return function(){return l.apply(n,O.call(arguments,0).concat([t,i]))}}function a(t){return function(i){return s(i,t)}}function p(t){return function(i){b[t]=i}}function c(t){if(o(g,t)){var i=g[t];delete g[t],y[t]=!0,f.apply(n,i)}if(!o(b,t)&&!o(y,t))throw new Error("No "+t);return b[t]}function h(t){var i,e=t?t.indexOf("!"):-1;return e>-1&&(i=t.substring(0,e),t=t.substring(e+1,t.length)),[i,t]}function u(t){return function(){return w&&w.config&&w.config[t]||{}}}var f,l,d,v,b={},g={},w={},y={},m=Object.prototype.hasOwnProperty,O=[].slice,j=/\.js$/;d=function(t,i){var e,n=h(t),o=n[0];return t=n[1],o&&(o=s(o,i),e=c(o)),o?t=e&&e.normalize?e.normalize(t,a(i)):s(t,i):(t=s(t,i),n=h(t),o=n[0],t=n[1],o&&(e=c(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:e}},v={require:function(t){return r(t)},exports:function(t){var i=b[t];return"undefined"!=typeof i?i:b[t]={}},module:function(t){return{id:t,uri:"",exports:b[t],config:u(t)}}},f=function(t,i,e,s){var a,h,u,f,l,w,m=[],O=typeof e;if(s=s||t,"undefined"===O||"function"===O){for(i=!i.length&&e.length?["require","exports","module"]:i,l=0;l<i.length;l+=1)if(f=d(i[l],s),h=f.f,"require"===h)m[l]=v.require(t);else if("exports"===h)m[l]=v.exports(t),w=!0;else if("module"===h)a=m[l]=v.module(t);else if(o(b,h)||o(g,h)||o(y,h))m[l]=c(h);else{if(!f.p)throw new Error(t+" missing "+h);f.p.load(f.n,r(s,!0),p(h),{}),m[l]=b[h]}u=e?e.apply(b[t],m):void 0,t&&(a&&a.exports!==n&&a.exports!==b[t]?b[t]=a.exports:u===n&&w||(b[t]=u))}else t&&(b[t]=e)},t=i=l=function(t,i,e,o,s){if("string"==typeof t)return v[t]?v[t](i):c(d(t,i).f);if(!t.splice){if(w=t,w.deps&&l(w.deps,w.callback),!i)return;i.splice?(t=i,i=e,e=null):t=n}return i=i||function(){},"function"==typeof e&&(e=o,o=s),o?f(n,t,i,e):setTimeout(function(){f(n,t,i,e)},4),l},l.config=function(t){return l(t)},t._defined=b,e=function(t,i,e){i.splice||(e=i,i=[]),o(b,t)||o(g,t)||(g[t]=[t,i,e])},e.amd={jQuery:!0}}(),e("../bower_components/almond/almond.js",function(){}),function(t,i){"object"==typeof exports&&module?module.exports=i():"function"==typeof e&&e.amd?e("../bower_components/pubsub-js/src/pubsub",i):t.PubSub=i()}("object"==typeof window&&window||this,function(){function t(t){var i;for(i in t)if(t.hasOwnProperty(i))return!0;return!1}function i(t){return function(){throw t}}function e(t,e,n){try{t(e,n)}catch(o){setTimeout(i(o),0)}}function n(t,i,e){t(i,e)}function o(t,i,o,s){var r,a=c[i],p=s?n:e;if(c.hasOwnProperty(i))for(r in a)a.hasOwnProperty(r)&&p(a[r],t,o)}function s(t,i,e){return function(){var n=String(t),s=n.lastIndexOf(".");for(o(t,t,i,e);-1!==s;)n=n.substr(0,s),s=n.lastIndexOf("."),o(t,n,i)}}function r(i){for(var e=String(i),n=Boolean(c.hasOwnProperty(e)&&t(c[e])),o=e.lastIndexOf(".");!n&&-1!==o;)e=e.substr(0,o),o=e.lastIndexOf("."),n=Boolean(c.hasOwnProperty(e)&&t(c[e]));return n}function a(t,i,e,n){var o=s(t,i,n),a=r(t);return a?(e===!0?o():setTimeout(o,0),!0):!1}var p={},c={},h=-1;return p.publish=function(t,i){return a(t,i,!1,p.immediateExceptions)},p.publishSync=function(t,i){return a(t,i,!0,p.immediateExceptions)},p.subscribe=function(t,i){if("function"!=typeof i)return!1;c.hasOwnProperty(t)||(c[t]={});var e="uid_"+String(++h);return c[t][e]=i,e},p.unsubscribe=function(t){var i,e,n,o="string"==typeof t,s=!1;for(i in c)if(c.hasOwnProperty(i)){if(e=c[i],o&&e[t]){delete e[t],s=t;break}if(!o)for(n in e)e.hasOwnProperty(n)&&e[n]===t&&(delete e[n],s=!0)}return s},p}),e("pubsub",["../bower_components/pubsub-js/src/pubsub"],function(t){function i(i,e){return t.publish(i,e)}function e(i,e){return t.subscribe(i,e)}return{publish:i,subscribe:e}}),e("util/mouse",[],function(){function t(t,i){var e=i.getBoundingClientRect();return{x:t.clientX-e.left*(i.width/e.width),y:t.clientY-e.top*(i.height/e.height)}}function i(t,i,e,n){var o,s,r=i.options,a=0,p=0,c=e.width-r.width,h=e.height-r.height;return o=t.x-n.x,o=a>o?a:o>c?c:o,s=t.y-n.y,s=p>s?p:s>h?h:s,{x:o,y:s}}function e(t,i){var e=t.options;return e.left<=i.x&&i.x<=e.left+e.width&&e.top<=i.y&&i.y<=e.top+e.height}function n(t,i){var n,o=-1;for(index in i){var s=i[index],r=e(s,t);r&&index>o&&(n=index)}return n?i[n]:!1}return{windowToCanvas:t,clampToCanvas:i,isTargetHit:e,getTargetObject:n}}),e("canvas",["pubsub","util/mouse"],function(t,i){function e(t){this.id=t,this.canvas=document.getElementById(this.id),this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("mousemove",this,!1),this.canvasObjects=[],this.activeObject}function n(e){var n=i.windowToCanvas(e,this.canvas),o=i.getTargetObject(n,this.canvasObjects);r=o?!0:!1,o&&(this.setActiveObject(o),t.publish("mousedown",{event:e,object:o})),o&&r&&(a.x=n.x-o.options.left,a.y=n.y-o.options.top,window.addEventListener("mousemove",this,!1)),this.canvas.removeEventListener("mousedown",this,!1),window.addEventListener("mouseup",this,!1)}function o(e){var n=this.getActiveObject(),o=i.windowToCanvas(e,this.canvas);if(r&&n){var s=n.options,p=i.clampToCanvas(o,n,this.canvas,a);s.left=p.x,s.top=p.y,t.publish("objectdrag",{event:e,object:n})}if(!r){var n=i.getTargetObject(o,this.canvasObjects);this.setActiveObject(n),this.setCursorOnActiveObject(n),n&&t.publish("objecthover",{event:e,object:n})}}function s(e){var n=i.windowToCanvas(e,this.canvas),o=i.getTargetObject(n,this.canvasObjects);this.canvas.addEventListener("mousedown",this,!1),window.removeEventListener("mouseup",this,!1),r&&(r=!1,window.removeEventListener("mousemove",this,!1)),o&&t.publish("mouseup",{event:e,object:o})}var r,a={};return e.prototype.getCanvasId=function(){return this.id},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getContext=function(){return this.ctx},e.prototype.getObjectCount=function(){return this.canvasObjects.length},e.prototype.getActiveObject=function(){return this.activeObject},e.prototype.setActiveObject=function(t){return this.activeObject=t},e.prototype.remove=function(t){var i=this.canvasObjects.indexOf(t);return-1!=i&&(this.canvasObjects.splice(i,1),this.reDrawObjects()),this},e.prototype.add=function(t){t.draw(this.ctx),t.options.layer=this.getObjectCount()+1,this.canvasObjects.push(t)},e.prototype.reDrawObjects=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(object in this.canvasObjects){var t=this.canvasObjects[object];t.draw(this.ctx)}},e.prototype.setCursorOnActiveObject=function(t){this.canvas.style.cursor=t?"move":"default"},e.prototype.handleEvent=function(t){switch(t.type){case"mousedown":n.apply(this,[t]);break;case"mousemove":o.apply(this,[t]);break;case"mouseup":s.apply(this,[t]);break;case"mouseover":mouseOverListener.apply(this,[t])}this.reDrawObjects()},e}),e("shapes/shape",["pubsub"],function(t){function i(){}return i.prototype.initializeOptions=function(t,i){this.options=i||{};for(option in t)this.options[option]=this.options[option]||t[option],this.options.hasOwnProperty("radius")&&(this.options.width=this.options.width||2*this.options.radius,this.options.height=this.options.height||2*this.options.radius)},i.prototype.set=function(t){for(option in t)this.options[option]=t[option]},i.prototype.on=function(i,e){var n=this;t.subscribe(i,function(t,i){n===i.object&&e&&e(t,i)})},i}),e("shapes/rectangle",["shapes/shape"],function(t){function i(t){this.initializeOptions(e,t)}var e={left:0,top:0,fill:"black",width:100,height:100,strokeStyle:"#fff",strokeWidth:null};return i.prototype=new t,i.prototype.draw=function(t){t.fillStyle=this.options.fill,t.fillRect(this.options.left,this.options.top,this.options.width,this.options.height),t.strokeStyle=this.options.strokeStyle,t.lineWidth=this.options.strokeWidth,this.options.strokeWidth&&t.strokeRect(this.options.left,this.options.top,this.options.width,this.options.height)},i}),e("shapes/circle",["shapes/shape"],function(t){function i(t){this.initializeOptions(e,t)}var e={left:0,top:0,fill:"black",radius:25};return i.prototype=new t,i.prototype.draw=function(t){t.beginPath(),t.arc(this.options.left+this.options.radius,this.options.top+this.options.radius,this.options.radius,0,2*Math.PI,!1),t.fillStyle=this.options.fill,t.fill(),this.options.strokeWidth&&t.strokeRect(this.options.left,this.options.top,this.options.width,this.options.height)},i}),e("shapes/image",["shapes/shape"],function(t){function i(t,i){this.imageObj=t,i.width=i.width||this.imageObj.width,i.height=i.height||this.imageObj.height,this.initializeOptions(e,i)}var e={left:0,top:0,angle:0,opacity:1};return i.prototype=new t,i.prototype.draw=function(t){t.drawImage(this.imageObj,this.options.left,this.options.top,this.options.width,this.options.height)},i}),e("shapes/text",["shapes/shape"],function(t){function i(t){this.initializeOptions(e,t)}var e={fontSize:24,font:"Times New Roman",fontWeight:"normal",text:"text",left:0,top:0,baseline:"top",fill:"black",strokeStyle:null,strokeWidth:0};return i.prototype=new t,i.prototype.draw=function(t){t.font=this.options.fontSize+"px "+this.options.font,t.fillStyle=this.options.fill,t.textBaseline=this.options.baseline;var i=t.measureText(this.options.text),e=this.options.width||i.width,n=this.options.height||this.options.fontSize+6;this.options.width=e,this.options.height=n,t.fillText(this.options.text,this.options.left,this.options.top),this.options.strokeWidth&&t.strokeRect(this.options.left,this.options.top,this.options.width,this.options.height)},i}),e("imagine",["canvas","shapes/rectangle","shapes/circle","shapes/image","shapes/text"],function(t,i,e,n,o){var s=function(t){return t};return s.Canvas=t,s.Rectangle=i,s.Circle=e,s.Image=n,s.Text=o,s}),i("imagine")});